<!DOCTYPE html>
<html class="no-js" lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>テトラコリック相関の初期 - Takahiro ONOSHIMA&#39;s website</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Takahiro ONOSHIMA&#39;s website" rel="home">
				<div class="logo__title">Takahiro ONOSHIMA&#39;s website</div>
				<div class="logo__tagline">小野島昂洋の個人サイト</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/profile/">
				
				<span class="menu__text">Profile</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/works/">
				
				<span class="menu__text">Works</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/stat/">
				
				<span class="menu__text">STAT/R</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/posts/">
				
				<span class="menu__text">Others</span>
				
			</a>
		</li>
	</ul>
</nav>


	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">テトラコリック相関の初期</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-06-18T15:10:22">June 18, 2019</time>
	<time class="meta__text" datetime="2021-01-16T18:13:29"> (Last Modified: January 16, 2021)</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/stat/" rel="category">stat</a>
	</span>
</div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#書誌情報">書誌情報</a></li>
    <li><a href="#テーブルの説明">テーブルの説明</a></li>
    <li><a href="#テーブル利用の実際">テーブル利用の実際</a></li>
    <li><a href="#rで実験">Rで実験</a></li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<p>テトラコリック相関係数関連の論文を読んだメモ。テトラコリック相関を計算するときに便利な表を作ったぞという話。</p>
<h2 id="書誌情報">書誌情報</h2>
<blockquote>
<p>Everitt, P. F. (1910). Tables of the tetrachoric functions for fourfold correlation talbes. <em>Biometrika, 7</em>(4), 437–451. <a href="https://doi.org/10.1093/biomet/7.4.437">https://doi.org/10.1093/biomet/7.4.437</a></p>
</blockquote>
<h2 id="テーブルの説明">テーブルの説明</h2>
<p>Pearson(1900)が発表したテトラコリック相関では以下のようなクロス表を想定して相関係数を求める。
<img src="/images/everitt_p437.png" alt="Everitt 437ページ" title="Everitt p.437">
(p.437)</p>
<p>左の図の実線はx軸とy軸である。点線の表す平面が二変量正規分布を切って4つの区画a,b,c,dに分けられてると考える。周辺確率を用いてhとkの値を求めることができる。</p>
<p>さて，この表から相関係数が求めるには以下の式が使われる。</p>
<p>$$ \frac{d}{N} = \frac{b+d}{N} \cdot \frac{c+d}{N}+S _ {1}^{\infty} (\frac{r^n}{n!}HK\bar{v} _ {n-1}\bar{w} _ {n-1}) \tag{1}$$</p>
<p>ここでHとKは正規曲線の縦座標（確率密度）である（Sは今の$\Sigma$）。$\bar{v}と\bar{w}$ は以下の式で与えられる。</p>
<p>$$
\bar{v} = h\bar{v} _ {n-1} - (n-1)\bar{v} _ {n-2}, \bar{v} _ 0 = 1, \bar{v} _ 1 = h
$$
$$
\bar{w} = k\bar{w} _ {n-1} - (n-1)\bar{w} _ {n-2}, \bar{w}_0 = 1, \bar{w} _ 1 = k
$$
これらを用いて，</p>
<p>$$\tau_n = \frac{H\bar{v} _ s{n-1}}{\sqrt{n!}}
$$
$$
\tau_n&rsquo; = \frac{K\bar{w} _ {n-1}}{\sqrt{n!}}
$$
とすると最初の(1)式は以下のように書き換えることができる。</p>
<p>$$ \frac{d}{N} = \frac{b+d}{N}\cdot \frac{c+d}{N} + S_{1}^{\infty}(\tau_n \tau_n&rsquo;r^n) \tag{ 2 } $$</p>
<p>この論文では，$\tau_6$までの数表が乗っていて，相関表からテトラコリック相関rを簡単に求められるようになっている。</p>
<h2 id="テーブル利用の実際">テーブル利用の実際</h2>
<p>論文では例として次のようなテーブルが挙げられている</p>
<p>こんな感じの2×2の表を使う，</p>
<table>
<thead>
<tr>
<th>1668 (a)</th>
<th>131 (b)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>137 (c )</strong></td>
<td><strong>64 (d)</strong></td>
</tr>
</tbody>
</table>
<p>この値を用いて，論文巻末の表を見る。巻末にはこんな感じで表が載っている。
<img src="/images/everitt2.png" alt="Everitt 巻末表" title="Everitt table">
(p.443)</p>
<p>表を用いると次のように値が求まる。</p>
<table>
<thead>
<tr>
<th>$\tau _ 1$</th>
<th>$\tau _ 2$</th>
<th>$\tau _ 3$</th>
<th>$\tau _ 4$</th>
<th>$\tau _ 5$</th>
<th>$\tau _ 6$</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.17228</td>
<td>0.15787</td>
<td>0.04779</td>
<td>-0.06018</td>
<td>-0.06693</td>
<td>0.00854</td>
</tr>
<tr>
<td>0.17614</td>
<td>0.159276</td>
<td>0.04567</td>
<td>-0.06275</td>
<td>-0.06652</td>
<td>0.01111</td>
</tr>
</tbody>
</table>
<p>これを(1)式に代入すると，</p>
<p>$$
0.032000 = 0.009799+0.030345r+0.025142r^2+0.002183r^3+0.003776r^4+0.004452r^5+0.000095r^6 \tag{3}
$$
となる。
あとはこの方程式を解けば$r=0.501$のようにテトラコリック相関係数が求まるそうである（論文だとニュートン法で解いたと書いてある）。</p>
<h2 id="rで実験">Rで実験</h2>
<p>データをまず入力。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1668</span>,<span style="color:#ae81ff">137</span>,<span style="color:#ae81ff">131</span>,<span style="color:#ae81ff">64</span>),<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)</code></pre></div></p>
<p>周辺頻度からhとkおよびHとKを計算する。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">N <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sum</span>(dat)
b_plus_d_byN <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colSums</span>(dat)[2]<span style="color:#f92672">/</span>N
<span style="color:#75715e">## 0.0975</span>
c_plus_d_byN <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rowSums</span>(dat)[2]<span style="color:#f92672">/</span>N
<span style="color:#75715e">## 0.1005</span>

h <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">qnorm</span>(b_plus_d_byN, lower.tail <span style="color:#f92672">=</span> F)
k <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">qnorm</span>(c_plus_d_byN, lower.tail <span style="color:#f92672">=</span> F)

H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dnorm</span>(h)
<span style="color:#75715e">## 0.1722765</span>
K <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dnorm</span>(k)
<span style="color:#75715e">## 0.1761384</span></code></pre></div>
<p>τを求める計算式を作る。愚直に数式を入力する。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">tau <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">6</span>)
v_bar <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">6</span>)

<span style="color:#a6e22e">for</span>(n in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>){
  <span style="color:#a6e22e">if</span>(n<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>){
    v_bar[n] <span style="color:#f92672">&lt;-</span> h
    tau[n] <span style="color:#f92672">&lt;-</span> (H<span style="color:#f92672">*</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">/</span><span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">factorial</span>(n))
  } else <span style="color:#a6e22e">if </span>(n<span style="color:#f92672">==</span><span style="color:#ae81ff">2</span>){
    v_bar[n] <span style="color:#f92672">&lt;-</span> h^2 <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
    tau[n] <span style="color:#f92672">&lt;-</span> H <span style="color:#f92672">*</span> v_bar[n<span style="color:#ae81ff">-1</span>] <span style="color:#f92672">/</span><span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">factorial</span>(n))
  } else{
    v_bar[n] <span style="color:#f92672">&lt;-</span> h <span style="color:#f92672">*</span> v_bar[n<span style="color:#ae81ff">-1</span>] <span style="color:#f92672">-</span> (n<span style="color:#ae81ff">-1</span>) <span style="color:#f92672">*</span> v_bar[n<span style="color:#ae81ff">-2</span>]
    tau[n] <span style="color:#f92672">&lt;-</span> (H <span style="color:#f92672">*</span> v_bar[n<span style="color:#ae81ff">-1</span>])<span style="color:#f92672">/</span><span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">factorial</span>(n))  
  }
}
<span style="color:#75715e">## tauの中身</span>
[1]  <span style="color:#ae81ff">0.172276537</span>  <span style="color:#ae81ff">0.157867340</span>  <span style="color:#ae81ff">0.047785511</span> <span style="color:#ae81ff">-0.060181440</span> <span style="color:#ae81ff">-0.066934070</span>  <span style="color:#ae81ff">0.008538122</span></code></pre></div>
<p>同じ要領で，もう一つの方のtauも求めて(3)式を作る。Rでニュートン法を使う際には<code>polyroot()</code>の関数を用いる。この関数では，多項式の係数を並べたベクトルを引数として与えると，多項式=0となる解を計算してくれる。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># dat[2,2]/Nは(2)式の左辺を右辺に移行したもの</span>
coef_vec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(b_plus_d_byN <span style="color:#f92672">*</span> c_plus_d_byN <span style="color:#f92672">-</span> dat[2,<span style="color:#ae81ff">2</span>]<span style="color:#f92672">/</span>N, tau <span style="color:#f92672">*</span> tau2 )
<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">polyroot</span>(coef_vector),<span style="color:#ae81ff">3</span>)
<span style="color:#75715e"># 結果のベクトル</span>
[1]  <span style="color:#ae81ff">0.502+0.00i</span>  <span style="color:#ae81ff">-1.544+0.67i</span>  <span style="color:#ae81ff">-1.544-0.67i</span>   <span style="color:#ae81ff">0.866-1.68i</span>   <span style="color:#ae81ff">0.866+1.68i</span>
<span style="color:#ae81ff">-46.007+0.00i</span></code></pre></div></p>
<p>1番目の引数に論文とほぼ同じ数値である$r=0.502$があり，テトラコリック相関が求まったことが分かる。</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/tetrachoric-correlation/" rel="tag">tetrachoric correlation</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 Takahiro ONOSHIMA.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$']]
  }
});
</script>

</body>
</html>
